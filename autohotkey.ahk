; ==================================================================================================
; #                              -- Universal Hotkey Script --                                    #
; ==================================================================================================
;
; 介绍:
;   本脚本旨在通过一系列精心设计的快捷键和按键映射，提升 Windows 操作系统的使用效率。
;   脚本主要分为两大模块：
;   1. 功能区：提供窗口管理、程序启动等便捷操作。
;   2. 核心功能区：重新映射按键，实现更高效的文本导航和编辑。
;
;   所有修改均旨在减少不必要的手部移动，优化日常操作流程。
;
; ==================================================================================================
; § 功能区：常规快捷键
; ==================================================================================================

; --- 功能1：智能关闭窗口 ---
;   说明：按下 Alt + Q 可关闭当前活动窗口。
;         此快捷键在桌面环境下无效，以防止误操作。
; --------------------------------------------------------------------------------------------------
!q::
if WinActive("ahk_class Progman") or WinActive("ahk_class WorkerW")
{
    return
}
else
{
    WinClose, A
}
return

; --- 功能2：最小化当前窗口 ---
;   说明：按下 Ctrl + Alt + Q 可将当前窗口最小化。
; --------------------------------------------------------------------------------------------------
^!q::WinMinimize, A

; --- 功能3：右Alt+P 映射为 Win+P (投影/显示器切换) ---
;   说明：按下 Alt + P (默认应为右Alt) 相当于按下 Win + P，用于快速打开投影设置。
; --------------------------------------------------------------------------------------------------
>!p::Send, #p

; --- 功能4：打开 Windows Terminal ---
;   说明：按下 Ctrl + Alt + T 快速启动 Windows Terminal。
;         请注意：下面的路径为绝对路径，如果您的 Terminal 位置不同，请手动修改。
; --------------------------------------------------------------------------------------------------
^!t::
Run, "D:\Lambda\Tools\Microsoft.WindowsTerminal_1.22.11751.0_x64\terminal-1.22.11751.0\wt.exe"
return

; ==================================================================================================
; § 核心功能区：按键映射
; ==================================================================================================

; --- 1. CapsLock 键 -> Esc 键 ---
;   说明：将大小写锁定键 (CapsLock) 的功能完全替换为 Esc 键。
;         使用 Send, {Esc} 是为了避免触发下方的 Esc 组合键。
; --------------------------------------------------------------------------------------------------
CapsLock::Send, {Esc}

; --- 2. Esc 键作为导航修饰键 (类 Vim 导航) ---
;   说明：将 Esc 键定义为一个“导航层”的触发键。
;         - 按住 Esc 并结合 H/J/K/L，可以实现光标的左/下/上/右移动。
;         - 单击 Esc 键 (按下并快速松开)，则发送原始的 Esc 功能。
; --------------------------------------------------------------------------------------------------
; 定义组合键
Esc & h::Send, {Left}
Esc & j::Send, {Down}
Esc & k::Send, {Up}
Esc & l::Send, {Right}

; 定义单击 Esc 的行为
Esc::
KeyWait, Esc, T0.2 ; 等待0.2秒，检查按键是否被释放
if ErrorLevel          ; 如果超时 (意味着 Esc 正被按住作为修饰键)
{
    return
}
else                   ; 如果在0.2秒内被释放 (意味着是单击)
{
    Send, {Esc}
}
return